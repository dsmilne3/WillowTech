// Write logs to your Grafana Cloud Metrics instance.
prometheus.remote_write "grafana_cloud_metrics_home" {
	endpoint {
		url = sys.env("GCLOUD_HOME_PROM_URL")

		basic_auth {
			username = sys.env("GCLOUD_HOME_PROM_USER")
			password = sys.env("GCLOUD_HOME_RW_API_KEY")
		}
	}
}

prometheus.remote_write "grafana_cloud_metrics_work" {
	endpoint {
		url = sys.env("GCLOUD_WORK_PROM_URL")

		basic_auth {
			username = sys.env("GCLOUD_WORK_PROM_USER")
			password = sys.env("GCLOUD_WORK_RW_API_KEY")
		}
	}
}

// This block creates the "pipeline export" that can be referenced by other FM pipelines
// References to the exported pipeline follow the syntax - argument.pipeline_exports.value["PIPELINE_NAME"]["EXPORT_NAME"]
// Example: forward_to = [argument.pipeline_exports.value["metrics_receiver"]["receiver"]]
// https://grafana.com/docs/grafana-cloud/send-data/fleet-management/set-up/configuration-pipelines/pipeline-export-injection/
export "receiver_home" {
	value = prometheus.remote_write.grafana_cloud_metrics_home.receiver
}

export "receiver_work" {
	value = prometheus.remote_write.grafana_cloud_metrics_work.receiver
}